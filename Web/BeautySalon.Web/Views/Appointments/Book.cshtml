@using BeautySalon.Web.ViewModels.Appoitments.InputModels;
@model BookAppointmentInputModel;


<section class="hero-wrap hero-wrap-2 custom-margin-identity" style="background-image: url('/images/bg_2.jpg');" data-stellar-background-ratio="0.5">
    <div class="overlay"></div>
    <div class="container">
        <div class="row no-gutters slider-text js-fullheight align-items-center justify-content-center">
            <div class="col-md-9 ftco-animate text-center">
                <h1 class="mb-3 bread">Contact us</h1>
                <p class="breadcrumbs"><span class="mr-2"><a href="index.html">Home</a></span> <span>Contact us</span></p>
            </div>
        </div>
    </div>
</section>
<section class="ftco-section contact-section">
    <div class="container">
        <div class="row block-9">
            <div class="col-md-4 contact-info ftco-animate bg-light p-4">
                <div class="row">
                    <div class="col-md-12 mb-4">
                        <h2 class="h4">Contact Information</h2>
                    </div>
                    <div class="col-md-12 mb-3">
                        <p><span>Address:</span> 198 West 21th Street, Suite 721 New York NY 10016</p>
                    </div>
                    <div class="col-md-12 mb-3">
                        <p><span>Phone:</span> <a href="tel://1234567920">+ 1235 2355 98</a></p>
                    </div>
                    <div class="col-md-12 mb-3">
                        <p><span>Email:</span> <a href="mailto:info@yoursite.com">info@yoursite.com</a></p>
                    </div>
                    <div class="col-md-12 mb-3">
                        <p><span>Website:</span> <a href="#">yoursite.com</a></p>
                    </div>
                </div>
            </div>
            <div class="col-md-1"></div>
            <div class="col-md-6 ftco-animate">
                <h2 class="mb-4">Book an Appointment</h2>
                <form id="form" asp-controller="Appointments" asp-action="Book" method="post" class="contact-form">
                    <div class="row theme-color-gold">
                        <div class="col-md-6 form-group">
                            <label asp-for="@Model.FirstName"></label>
                            <input asp-for="@Model.FirstName" readonly type="text" class="form-control" />
                            <span asp-validation-for="@Model.FirstName" class="text-danger"></span>
                        </div>
                        <div class="col-md-6 form-group">
                            <label asp-for="@Model.LastName"></label>
                            <input asp-for="@Model.LastName" readonly type="text" class="form-control" />
                            <span asp-validation-for="@Model.LastName" class="text-danger"></span>
                        </div>
                        <div class="col-md-6 form-group">
                            <label asp-for="@Model.Email"></label>
                            <input asp-for="@Model.Email" readonly type="text" class="form-control" />
                            <span asp-validation-for="@Model.Email" class="text-danger"></span>
                        </div>
                        <div class="col-md-6 form-group">
                            <label asp-for="@Model.PhoneNumber"></label>
                            <input asp-for="@Model.PhoneNumber" readonly type="text" class="form-control" />
                            <span asp-validation-for="@Model.PhoneNumber" class="text-danger"></span>
                        </div>
                        <div class="col-md-12 form-group">
                            <label asp-for="@Model.CategoryName"></label>
                            <select id="category" asp-for="@Model.CategoryName" class="form-control" asp-items="@Model.Categories">
                                <option selected>Please select beauty category</option>
                            </select>
                            <span asp-validation-for="@Model.CategoryName" class="text-danger"></span>
                        </div>
                        <div class="col-md-12 form-group">
                            <label asp-for="@Model.StylistName"></label>
                            <select id="stylist" asp-for="@Model.StylistName" type="text" class="form-control">
                            </select>
                            <span asp-validation-for="@Model.StylistName" class="text-danger"></span>
                        </div>
                        <div class="col-md-12 form-group">
                            <label asp-for="@Model.ProcedureName"></label>
                            <select id="procedure" asp-for="@Model.ProcedureName" type="text" class="form-control"></select>
                            <span asp-validation-for="@Model.ProcedureName" class="text-danger"></span>
                        </div>
                        <div class="col-md-6 form-group">
                            <label asp-for="@Model.Date"></label>
                            <input id="datepicker" asp-for="@Model.Date" type="text" class="form-control" value="@DateTime.UtcNow.ToShortDateString()" />
                            <span asp-validation-for="@Model.Date" class="text-danger"></span>
                        </div>
                        <div class="col-md-6 form-group">
                            <label asp-for="@Model.Time"></label>
                            <input asp-for="@Model.Time" type="text" class="form-control" />
                            <span asp-validation-for="@Model.Time" class="text-danger"></span>
                        </div>
                        <div class="col-md-12 form-group">
                            <label asp-for="Comment"></label>
                            <textarea asp-for="Comment" cols="30" rows="7" class="form-control"></textarea>
                            <span asp-validation-for="Comment" class="text-danger"></span>
                        </div>
                        <div class="col-mn-12 form-group">
                            <input type="submit" value="Book an Appointment" class="btn btn-primary py-3 px-5">
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</section>

@*
    <div class="form-group">
        <label asp-for="Time"></label><br />
        <select id="time" asp-for="Time" class="form-control col-md-12">
            <option value="">Please select Time</option>
        </select>
        <span asp-validation-for="Time" class="text-danger"></span>
    </div>*@

<script>
    $(function () {
        $("#datepicker").datepicker({
            startDate: new Date(),
            endDate: "+4m",
        });
    });

    var categoryInput = document.getElementById("category");
    categoryInput.addEventListener("change", loadStylists);

    function loadStylists(event) {
        let categoryId = "";

        Array.from(event.target.children).forEach(child => {
            if (child.selected === true) {
                categoryId = child.value;
            }
        });

        var token = $("#form input[name=__RequestVerificationToken]").val();

        $.ajax({
            url: "/Stylists/GetStylistsByCategory/",
            type: "POST",
            data: JSON.stringify(categoryId),
            contentType: "application/json; charset=utf-8",
            headers: { 'X-CSRF-TOKEN': token },
            dataType: "json",
            success: function (data) {
                let result = '<option selected>Please select stylist</option>';

                data.stylistNames.forEach(stylyst => {
                    result += `<option value="${stylyst.id}">${stylyst.fullName}</option>`
                });

                $('#stylist').html(result);
            }
        });
    }

    var stylistInput = document.getElementById("stylist");
    stylistInput.addEventListener("change", loadProcedures);

    function loadProcedures(event) {
        let stylistId = "";

        Array.from(event.target.children).forEach(child => {
            if (child.selected === true) {
                stylistId = child.value;
            }
        });

        var token = $("#form input[name=__RequestVerificationToken]").val();

        $.ajax({
            url: "/Procedures/GetProceduresByStylist/",
            type: "POST",
            data: JSON.stringify(stylistId),
            contentType: "application/json; charset=utf-8",
            headers: { 'X-CSRF-TOKEN': token },
            dataType: "json",
            success: function (data) {
                let result = '<option selected>Please select procedure</option>';

                data.procedureNames.forEach(procedure => {
                    result += `<option value="${procedure.procedureId}">${procedure.procedureName}</option>`
                });

                $('#procedure').html(result);
            }
        });
    }

    //var dateInput = document.getElementById("datepicker");
    //dateInput.addEventListener("change", test);

    //function test() {
    //    console.log("in")
    //}

    //$('#datepicker').on('changeDate', function (event) {
    //    console.log(dateInput.value)
    //});

</script>
@*@section Scripts
        {
        <script>

            $("#date").change(function () {
                var employee = $("#employee").val();
                var date = $("#date").val();
                var url = "/Appointments/GetTimes";
                $.getJSON(url, { Date: date, Employee: employee }, function (data) {
                    var item = "";
                    item += '<option value="' + "Please select stylist" + '">' + "Please select time" + '</option>'
                    $("#time").empty();
                    $.each(data, function (i, time) {
                        item += '<option value="' + time + '">' + time + '</option>'
                    });
                    $("#time").html(item);
                    if ($("#time").val() === null) {
                        alert("On Sunday we are closed! Please Pick another day");
                    }
                });
            });
        </script>
    }*@